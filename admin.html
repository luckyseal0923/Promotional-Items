<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬é—œå“å¾Œè‡ºç®¡ç†ç³»çµ± - Pro Edition</title>
    <style>
        :root {
            --primary: #10B981; /* è–„è·ç¶  */
            --primary-dark: #059669;
            --bg: #F8FAFC;
            --sidebar-bg: #FFFFFF;
            --text: #334155;
            --border: #E2E8F0;
            --danger: #EF4444;
            --warning: #F59E0B;
            --info: #3B82F6;
        }

        body, html { height: 100%; margin: 0; font-family: "PingFang TC", sans-serif; background: var(--bg); color: var(--text); }
        .hidden { display: none !important; }

        /* ç™»å…¥ä»‹é¢ */
        #loginView {
            display: flex; align-items: center; justify-content: center;
            height: 100vh; background: #0F172A; position: fixed; inset: 0; z-index: 9999;
        }
        .login-card { background: white; padding: 40px; border-radius: 16px; width: 90%; max-width: 360px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }

        /* ä¸»ä½ˆå±€ RWD */
        #adminView { display: none; min-height: 100vh; }
        .sidebar {
            width: 260px; background: var(--sidebar-bg); height: 100vh; position: fixed;
            padding: 24px; border-right: 1px solid var(--border); box-sizing: border-box; z-index: 100;
        }
        .main-content { margin-left: 260px; padding: 30px; transition: 0.3s; }

        @media (max-width: 900px) {
            .sidebar { width: 70px; padding: 15px 5px; text-align: center; }
            .sidebar h2, .sidebar .nav-text { display: none; }
            .main-content { margin-left: 70px; padding: 15px; }
            .filter-bar { flex-direction: column; gap: 10px; align-items: stretch !important; }
        }

        /* å°è¦½ */
        .nav-item { 
            padding: 14px 18px; border-radius: 10px; margin-bottom: 8px; cursor: pointer; color: #64748B;
            display: flex; align-items: center; gap: 12px; transition: 0.2s;
        }
        .nav-item:hover { background: #F1F5F9; color: var(--primary); }
        .nav-item.active { background: var(--primary); color: white; font-weight: bold; }

        /* é¢æ¿ */
        .panel { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 24px; border: 1px solid var(--border); }
        h1 { font-size: 22px; margin-bottom: 24px; color: #0F172A; border-left: 5px solid var(--primary); padding-left: 15px; }

        /* è¡¨æ ¼èˆ‡æŒ‰éˆ• */
        .table-container { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 700px; }
        th { text-align: left; padding: 12px; background: #F8FAFC; color: #64748B; font-size: 13px; border-bottom: 2px solid var(--border); }
        td { padding: 16px 12px; border-bottom: 1px solid var(--border); font-size: 14px; }

        .btn { padding: 10px 16px; border-radius: 8px; border: none; cursor: pointer; font-size: 13px; font-weight: 600; display: inline-flex; align-items: center; gap: 6px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: #10B981; color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-outline { background: white; border: 1px solid var(--border); color: var(--text); }

        /* ç‹€æ…‹æ¨™ç±¤ */
        .status-pill { padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: bold; }
        .status-1 { background: #DBEAFE; color: #1E40AF; } /* ç”³è«‹æå‡º */
        .status-2 { background: #FEF3C7; color: #92400E; } /* å•†å“æº–å‚™ä¸­ */
        .status-3 { background: #DCFCE7; color: #166534; } /* é€šçŸ¥é ˜å– */
        .status-4 { background: #FEE2E2; color: #991B1B; } /* ç•°å¸¸é€šçŸ¥ */

        input, select, textarea { padding: 10px; border: 1px solid var(--border); border-radius: 8px; outline: none; }
        .img-thumb { width: 45px; height: 45px; border-radius: 8px; object-fit: cover; background: #EEE; }

        /* å½ˆçª— */
        .modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.5); display: none; align-items: center; justify-content: center; z-index: 5000; padding: 15px; }
        .modal-body { background: white; padding: 30px; border-radius: 16px; width: 100%; max-width: 450px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <div id="loginView">
        <div class="login-card">
            <h2 style="color:var(--primary-dark)">å…¬é—œå“ç®¡ç†å¾Œè‡º</h2>
            <input type="text" id="user" placeholder="å¸³è™Ÿ" value="admin" style="width:100%; margin-bottom:12px">
            <input type="password" id="pass" placeholder="å¯†ç¢¼" value="1234" style="width:100%; margin-bottom:24px">
            <button class="btn btn-primary" style="width:100%; justify-content:center" onclick="handleLogin()">ç™»å…¥ç³»çµ±</button>
        </div>
    </div>

    <div id="adminView">
        <div class="sidebar">
            <h2 style="color:var(--primary-dark); font-size:20px; margin-bottom:30px">å¾Œè‡ºç®¡ç†</h2>
            <div class="nav-item active" id="nav-orders" onclick="switchTab('orders')">ğŸ“‹ <span class="nav-text">è¨‚å–®ç®¡ç†ç³»çµ±</span></div>
            <div class="nav-item" id="nav-inventory" onclick="switchTab('inventory')">âš–ï¸ <span class="nav-text">åº«å­˜ç›¤é» (åŠ /æ¸›)</span></div>
            <div class="nav-item" id="nav-listing" onclick="switchTab('listing')">ğŸš€ <span class="nav-text">å•†å“ä¸Šæ¶/ä¸‹æ¶</span></div>
            <div class="nav-item" id="nav-accounts" onclick="switchTab('accounts')">ğŸ‘¥ <span class="nav-text">å¸³è™Ÿæ¬Šé™è¨­å®š</span></div>
            <div style="margin-top:50px"><button class="btn btn-outline" style="width:100%" onclick="location.reload()">ğŸ”’ å®‰å…¨ç™»å‡º</button></div>
        </div>

        <div class="main-content">
            <div id="tab-orders">
                <h1>è¨‚å–®ç®¡ç†ç³»çµ±</h1>
                <div class="panel">
                    <div class="filter-bar" style="display:flex; gap:12px; margin-bottom:20px; align-items:flex-end">
                        <input type="date" id="filterStart"> <input type="date" id="filterEnd">
                        <button class="btn btn-primary" onclick="filterOrders()">ç¯©é¸å€é–“</button>
                        <button class="btn btn-success" onclick="downloadCSV()">ä¸‹è¼‰å ±è¡¨ (CSV)</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>æ—¥æœŸ</th><th>å–®è™Ÿ</th><th>ç”³è«‹äºº</th><th>è¨‚å–®å…§å®¹</th><th>ç•¶å‰ç‹€æ…‹</th><th>ç‹€æ…‹åˆ‡æ›</th></tr></thead>
                            <tbody id="orderTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="tab-inventory" class="hidden">
                <h1>å•†å“åº«å­˜ç›¤é» (ä½¿ç”¨ +3 æˆ– -3)</h1>
                <div class="panel">
                    <div class="table-container">
                        <table>
                            <thead><tr><th>ç¸®åœ–</th><th>å•†å“åç¨±</th><th>å–®åƒ¹</th><th>ç›®å‰åº«å­˜</th><th>ç›¤é»é‡</th><th>æ“ä½œ</th></tr></thead>
                            <tbody id="inventoryBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="tab-listing" class="hidden">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                    <h1>å•†å“ä¸Šæ¶ç®¡ç†</h1>
                    <button class="btn btn-primary" onclick="openAddModal()">ï¼‹ æ–°å¢å•†å“ä¸Šç·š</button>
                </div>
                <div class="panel">
                    <div class="table-container">
                        <table>
                            <thead><tr><th>åœ–ç‰‡</th><th>å•†å“åç¨±</th><th>ä¸Šæ¶å–®åƒ¹</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th></tr></thead>
                            <tbody id="listingBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="tab-accounts" class="hidden">
                <h1>å¸³è™Ÿæ¬Šé™è¨­å®š</h1>
                <div class="panel">
                    <div style="display:flex; gap:12px; margin-bottom:24px">
                        <input type="text" id="newAccUser" placeholder="æ–°ç®¡ç†å“¡å¸³è™Ÿ">
                        <input type="password" id="newAccPass" placeholder="åˆå§‹å¯†ç¢¼">
                        <button class="btn btn-primary" onclick="addAccount()">æ–°å¢å¸³è™Ÿ</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>ç®¡ç†å“¡åç¨±</th><th>æ¬Šé™ç­‰ç´š</th><th>å¸³è™Ÿç‹€æ…‹</th><th>æ“ä½œ</th></tr></thead>
                            <tbody id="accountTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="mainModal" class="modal">
        <div class="modal-body" id="modalBody"></div>
    </div>

    <script>
        // è™›æ“¬å•†å“è³‡æ–™
        let ITEMS = [
            {id: 1, name: 'åŒ—é†«å¹³å®‰åŒ…', price: 460, stock: 25, img: 'https://via.placeholder.com/50', active: true},
            {id: 2, name: 'ç¿è­·ç²¾è£½é‹¼ç­†', price: 800, stock: 12, img: 'https://via.placeholder.com/50', active: true},
            {id: 3, name: 'ä¿æº«éš¨è¡Œæ¯', price: 550, stock: 8, img: 'https://via.placeholder.com/50', active: true},
            {id: 4, name: 'ç™‚ç™’å°æ¤æ ½', price: 320, stock: 15, img: 'https://via.placeholder.com/50', active: true},
            {id: 5, name: 'é˜²æ°´é‡é¤å¢Š', price: 450, stock: 20, img: 'https://via.placeholder.com/50', active: true},
            {id: 6, name: 'å¸†å¸ƒæç±ƒ', price: 280, stock: 30, img: 'https://via.placeholder.com/50', active: true}
        ];

        // 12 ç­†è¨‚å–®è™›æ“¬å¡ç‰‡å…§å®¹
        let ORDERS = [
            {id:'TASK-101', date:'2026-02-01', user:'å¼µæ™ºç¶­ (104114)', items:[{n:'å¹³å®‰åŒ…', q:1}], status:'é€šçŸ¥é ˜å–', memo:''},
            {id:'TASK-102', date:'2026-02-02', user:'æé›…å©· (104225)', items:[{n:'é‹¼ç­†', q:2}], status:'ç”³è«‹æå‡º', memo:''},
            {id:'TASK-103', date:'2026-02-03', user:'ç‹å¤§åŒ (104336)', items:[{n:'éš¨è¡Œæ¯', q:1}, {n:'æç±ƒ', q:2}], status:'å•†å“æº–å‚™ä¸­', memo:''},
            {id:'TASK-104', date:'2026-02-04', user:'é™³å°æ˜ (104447)', items:[{n:'é‡é¤å¢Š', q:5}], status:'ç•°å¸¸é€šçŸ¥', memo:'ç‰©æµå»¶é²ï¼Œå·²è¯ç¹«'},
            {id:'TASK-105', date:'2026-02-05', user:'æ—ç¾ç² (104558)', items:[{n:'æ¤æ ½', q:3}], status:'é€šçŸ¥é ˜å–', memo:''},
            {id:'TASK-106', date:'2026-02-06', user:'é»ƒå°ˆå“¡ (104669)', items:[{n:'å¹³å®‰åŒ…', q:2}], status:'ç”³è«‹æå‡º', memo:''},
            {id:'TASK-107', date:'2026-02-07', user:'æ›¾ä¸»ä»» (104770)', items:[{n:'é‹¼ç­†', q:10}], status:'ç•°å¸¸é€šçŸ¥', memo:'åº«å­˜åˆ†é…ä¸è¶³'},
            {id:'TASK-108', date:'2026-02-08', user:'å‘¨é†«è­· (104881)', items:[{n:'æç±ƒ', q:1}], status:'å•†å“æº–å‚™ä¸­', memo:''},
            {id:'TASK-109', date:'2026-02-09', user:'å³ç§˜æ›¸ (104992)', items:[{n:'éš¨è¡Œæ¯', q:4}], status:'é€šçŸ¥é ˜å–', memo:''},
            {id:'TASK-110', date:'2026-02-10', user:'è¨±çµ„é•· (105003)', items:[{n:'é‡é¤å¢Š', q:1}], status:'ç”³è«‹æå‡º', memo:''},
            {id:'TASK-111', date:'2026-02-11', user:'è”¡æ•™æˆ (105114)', items:[{n:'å¹³å®‰åŒ…', q:1}, {n:'é‹¼ç­†', q:1}], status:'å•†å“æº–å‚™ä¸­', memo:''},
            {id:'TASK-112', date:'2026-02-12', user:'éŸ“é†«å¸« (105225)', items:[{n:'æ¤æ ½', q:2}], status:'é€šçŸ¥é ˜å–', memo:''}
        ];

        let ACCOUNTS = [{user:'admin', pass:'1234', role:'è¶…ç´šç®¡ç†å“¡', active:true}];

        function handleLogin() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            if(ACCOUNTS.find(a => a.user === u && a.pass === p)) {
                document.getElementById('loginView').style.display = 'none';
                document.getElementById('adminView').style.display = 'block';
                renderAll();
            } else alert('å¸³è™Ÿå¯†ç¢¼ä¸æ­£ç¢º');
        }

        function switchTab(t) {
            ['orders','inventory','listing','accounts'].forEach(id => {
                document.getElementById('tab-'+id).classList.add('hidden');
                document.getElementById('nav-'+id).classList.remove('active');
            });
            document.getElementById('tab-'+t).classList.remove('hidden');
            document.getElementById('nav-'+t).classList.add('active');
        }

        function renderAll() { renderOrders(); renderInventory(); renderListing(); renderAccounts(); }

        // --- è¨‚å–®é‚è¼¯ (æ¢å¾©æ‰€æœ‰è¨­å®š) ---
        function renderOrders(data = ORDERS) {
            document.getElementById('orderTable').innerHTML = data.map(o => `
                <tr>
                    <td>${o.date}</td><td><b>${o.id}</b></td><td>${o.user}</td>
                    <td><button class="btn btn-outline" onclick="showOrderDetail('${o.id}')">æŸ¥çœ‹ (å…± ${o.items.length} é …)</button></td>
                    <td><span class="status-pill status-${getStatusID(o.status)}">${o.status}</span></td>
                    <td>
                        <select onchange="changeStatus('${o.id}', this.value)">
                            <option value="">è½‰è‡³...</option>
                            <option value="ç”³è«‹æå‡º">ç”³è«‹æå‡º</option>
                            <option value="å•†å“æº–å‚™ä¸­">å•†å“æº–å‚™ä¸­</option>
                            <option value="é€šçŸ¥é ˜å–">é€šçŸ¥é ˜å– (ç™¼ä¿¡)</option>
                            <option value="ç•°å¸¸é€šçŸ¥">ç•°å¸¸é€šçŸ¥</option>
                        </select>
                    </td>
                </tr>
            `).join('');
        }

        function showOrderDetail(id) {
            const o = ORDERS.find(ord => ord.id === id);
            openModal(`
                <h3>è¨‚å–®æ˜ç´°å…§å®¹</h3>
                <div style="background:#F1F5F9; padding:15px; border-radius:12px; margin-bottom:15px">
                    ${o.items.map(i => `<p>ğŸ“ ${i.n} x ${i.q}</p>`).join('')}
                </div>
                ${o.memo ? `<p style="color:var(--danger)">âš ï¸ ç•°å¸¸å‚™è¨»ï¼š${o.memo}</p>` : ''}
                <button class="btn btn-primary" style="width:100%" onclick="closeModal()">é—œé–‰</button>
            `);
        }

        function changeStatus(id, s) {
            if(!s) return;
            if(s === 'é€šçŸ¥é ˜å–') {
                if(confirm('ç¢ºèªè¦åŸ·è¡Œ Workflow ä¸¦å¯„å‡ºé ˜å–éƒµä»¶é€šçŸ¥å—ï¼Ÿ')) {
                    alert(id + ' å·²è§¸ç™¼ n8n Workflow ä¸¦ç™¼ä¿¡ï¼');
                    applyStatus(id, s);
                }
            } else if(s === 'ç•°å¸¸é€šçŸ¥') {
                const memo = prompt('è«‹è¼¸å…¥ç•°å¸¸åŸå›  (30-50å­—)ï¼š');
                if(!memo) return;
                applyStatus(id, s, memo);
            } else { applyStatus(id, s); }
        }

        function applyStatus(id, s, m = '') {
            const o = ORDERS.find(ord => ord.id === id);
            o.status = s;
            if(m) o.memo = m;
            renderOrders();
        }

        // --- ç›¤é»é‚è¼¯ (+3/-3) ---
        function renderInventory() {
            document.getElementById('inventoryBody').innerHTML = ITEMS.filter(i=>i.active).map(i => `
                <tr>
                    <td><img src="${i.img}" class="img-thumb"></td>
                    <td>${i.name}</td><td>$${i.price}</td><td><b>${i.stock}</b></td>
                    <td><input type="text" id="adj-${i.id}" placeholder="+3 / -3" style="width:70px"></td>
                    <td><button class="btn btn-success" onclick="adjustStock(${i.id})">ç›¤é»æ›´æ–°</button></td>
                </tr>
            `).join('');
        }

        function adjustStock(id) {
            const val = document.getElementById('adj-'+id).value.trim();
            const item = ITEMS.find(i => i.id === id);
            if(val.startsWith('+')) item.stock += parseInt(val.substring(1));
            else if(val.startsWith('-')) item.stock -= parseInt(val.substring(1));
            else return alert('è«‹ä½¿ç”¨ +3 æˆ– -3 çš„æ ¼å¼');
            renderInventory();
            alert('ç›¤é»æˆåŠŸï¼æ–°åº«å­˜ï¼š' + item.stock);
        }

        // --- ä¸Šæ¶/ä¸‹æ¶é‚è¼¯ ---
        function renderListing() {
            document.getElementById('listingBody').innerHTML = ITEMS.map(i => `
                <tr>
                    <td><img src="${i.img}" class="img-thumb"></td>
                    <td>${i.name}</td><td>$${i.price}</td>
                    <td>${i.active ? '<span style="color:green">â— ä¸Šæ¶ä¸­</span>':'<span style="color:red">â— å·²ä¸‹æ¶</span>'}</td>
                    <td><button class="btn ${i.active?'btn-danger':'btn-primary'}" onclick="toggleItem(${i.id})">${i.active?'ä¸‹æ¶':'é‡æ–°ä¸Šæ¶'}</button></td>
                </tr>
            `).join('');
        }

        function toggleItem(id) {
            const item = ITEMS.find(i => i.id === id);
            item.active = !item.active;
            renderAll();
        }

        function openAddModal() {
            openModal(`
                <h3>æ–°å¢å•†å“ä¸Šç·š</h3>
                <label>å•†å“åç¨±</label><input type="text" id="newName" style="width:100%; margin-bottom:15px">
                <label>å–®åƒ¹ (NT$)</label><input type="number" id="newPrice" value="500" style="width:100%; margin-bottom:15px">
                <label>åˆå§‹é€²è²¨é‡</label><input type="number" id="newStock" value="50" style="width:100%; margin-bottom:20px">
                <div style="display:flex; gap:10px">
                    <button class="btn btn-outline" style="flex:1" onclick="closeModal()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" style="flex:1" onclick="confirmAdd()">ç¢ºèªä¸Šæ¶</button>
                </div>
            `);
        }

        function confirmAdd() {
            const n = document.getElementById('newName').value;
            const p = parseInt(document.getElementById('newPrice').value);
            const s = parseInt(document.getElementById('newStock').value);
            if(!n) return alert('è«‹è¼¸å…¥åç¨±');
            ITEMS.push({id: Date.now(), name: n, price: p, stock: s, img: 'https://via.placeholder.com/50', active: true});
            renderAll();
            closeModal();
        }

        // --- å¸³è™Ÿç®¡ç†é‚è¼¯ ---
        function renderAccounts() {
            document.getElementById('accountTable').innerHTML = ACCOUNTS.map(a => `
                <tr>
                    <td>${a.user}</td><td>${a.role}</td>
                    <td>${a.active ? 'â— æ­£å¸¸ä½¿ç”¨':'â— å·²åœæ¬Š'}</td>
                    <td><button class="btn btn-outline" onclick="alert('Demoç’°å¢ƒç¦æ­¢æ“ä½œåˆå§‹å¸³è™Ÿ')">è¨­å®š</button></td>
                </tr>
            `).join('');
        }

        function addAccount() {
            const u = document.getElementById('newAccUser').value;
            const p = document.getElementById('newAccPass').value;
            if(!u || !p) return;
            ACCOUNTS.push({user: u, pass: p, role: 'ç®¡ç†å“¡', active: true});
            renderAccounts();
            alert('å¸³è™Ÿå·²æ–°å¢');
        }

        // --- å·¥å…· ---
        function getStatusID(s) { return {'ç”³è«‹æå‡º':1, 'å•†å“æº–å‚™ä¸­':2, 'é€šçŸ¥é ˜å–':3, 'ç•°å¸¸é€šçŸ¥':4}[s]; }
        function openModal(html) { document.getElementById('modalBody').innerHTML = html; document.getElementById('mainModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('mainModal').style.display = 'none'; }
        function filterOrders() { alert('ç¯©é¸å€é–“æˆåŠŸ'); }
        function downloadCSV() {
            let csv = "\ufeffæ—¥æœŸ,å–®è™Ÿ,ç”³è«‹äºº,ç‹€æ…‹\n";
            ORDERS.forEach(o => csv += `${o.date},${o.id},${o.user},${o.status}\n`);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "å…¬é—œå“å ±è¡¨.csv";
            link.click();
        }
    </script>
</body>
</html>
