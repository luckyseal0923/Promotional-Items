<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬é—œå“å¾Œè‡ºç®¡ç†ç³»çµ± - Pink Bright Edition</title>
    <style>
        :root {
            --primary: #FF66A1; /* æ«»æ¡ƒç²‰ */
            --primary-light: #FFB3D1;
            --secondary: #FFF0F5; /* æ·ºç²‰ç´…åº• */
            --success: #6BCB77;
            --danger: #FF6B6B;
            --warning: #FFD93D;
            --text: #4D4D4D;
            --bg: #FFF9FB;
        }

        body, html { height: 100%; margin: 0; font-family: "PingFang TC", "Hiragino Sans GB", sans-serif; background: var(--bg); color: var(--text); }
        .hidden { display: none !important; }

        /* ç™»å…¥é  - äº®ç²‰è‰²èª¿ */
        #loginView {
            display: flex; align-items: center; justify-content: center;
            height: 100vh; background: linear-gradient(135deg, #FF99C8 0%, #FF66A1 100%);
            position: fixed; inset: 0; z-index: 9999;
        }
        .login-card { background: white; padding: 40px; border-radius: 24px; width: 340px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }

        /* ä¸»ä½ˆå±€ */
        #adminView { display: none; min-height: 100vh; }
        .sidebar {
            width: 260px; background: white; height: 100vh; position: fixed;
            padding: 24px; border-right: 1px solid #FFE4ED; box-sizing: border-box;
        }
        .main-content { margin-left: 260px; padding: 40px; background: var(--bg); }

        .nav-item { 
            padding: 14px 18px; border-radius: 12px; margin-bottom: 8px; cursor: pointer; color: #999; transition: 0.3s;
            display: flex; align-items: center; gap: 10px;
        }
        .nav-item:hover { background: var(--secondary); color: var(--primary); }
        .nav-item.active { background: var(--primary); color: white; font-weight: bold; box-shadow: 0 4px 12px rgba(255, 102, 161, 0.3); }

        /* é¢æ¿èˆ‡å¡ç‰‡ */
        .panel { background: white; border-radius: 20px; padding: 28px; box-shadow: 0 4px 15px rgba(255, 182, 193, 0.1); margin-bottom: 24px; border: 1px solid #FFF0F5; }
        h1 { font-size: 26px; color: var(--primary); margin-bottom: 30px; border-left: 6px solid var(--primary); padding-left: 15px; }

        /* è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; background: #FFF5F8; color: var(--primary); font-weight: 600; }
        td { padding: 18px 15px; border-bottom: 1px solid #FFF0F5; }
        tr:hover { background-color: #FFFAFC; }

        .btn { padding: 10px 18px; border-radius: 10px; border: none; cursor: pointer; font-size: 14px; font-weight: 600; transition: 0.2s; display: inline-flex; align-items: center; gap: 6px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-outline { background: white; color: var(--primary); border: 1.5px solid var(--primary); }
        .btn-outline:hover { background: var(--primary); color: white; }

        /* ç‹€æ…‹æ¨™ç±¤ */
        .status-pill { padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: bold; }
        .status-1 { background: #E3F2FD; color: #1976D2; } /* ç”³è«‹æå‡º */
        .status-2 { background: #FFF9C4; color: #FBC02D; } /* å•†å“æº–å‚™ä¸­ */
        .status-3 { background: #E8F5E9; color: #388E3C; } /* é€šçŸ¥é ˜å– */
        .status-4 { background: #FFEBEE; color: #D32F2F; } /* ç•°å¸¸é€šçŸ¥ */

        input, select, textarea { padding: 12px; border: 1px solid #FFD1E1; border-radius: 10px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 5px rgba(255, 102, 161, 0.2); }

        .img-preview { width: 60px; height: 60px; border-radius: 12px; object-fit: cover; background: #EEE; border: 1px solid #FFD1E1; }

        /* å½ˆçª— */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: none; align-items: center; justify-content: center; z-index: 5000; backdrop-filter: blur(4px); }
        .modal-body { background: white; padding: 35px; border-radius: 25px; width: 450px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <div id="loginView">
        <div class="login-card">
            <h2 style="color:var(--primary)">ğŸ€ å…¬é—œå“ç®¡ç†å¾Œè‡º</h2>
            <p style="color:#999; font-size:14px">Bright & Pink Admin System</p>
            <input type="text" id="user" placeholder="ç®¡ç†å“¡å¸³è™Ÿ" value="admin" style="width:100%; margin-bottom:12px; box-sizing:border-box">
            <input type="password" id="pass" placeholder="å®‰å…¨å¯†ç¢¼" value="1234" style="width:100%; margin-bottom:24px; box-sizing:border-box">
            <button class="btn btn-primary" style="width:100%; justify-content:center" onclick="handleLogin()">ç™»å…¥ç³»çµ±</button>
        </div>
    </div>

    <div id="adminView">
        <div class="sidebar">
            <h2 style="color:var(--primary); font-size:22px; margin-bottom:40px">å…¬é—œå“ç®¡ç†</h2>
            <div class="nav-item active" id="nav-orders" onclick="switchTab('orders')">ğŸ“‹ è¨‚å–®ç®¡ç†ç³»çµ±</div>
            <div class="nav-item" id="nav-inventory" onclick="switchTab('inventory')">âš–ï¸ å•†å“åº«å­˜ç›¤é»</div>
            <div class="nav-item" id="nav-listing" onclick="switchTab('listing')">ğŸŒ¸ å•†å“ä¸Šæ¶åŠŸèƒ½</div>
            <div class="nav-item" id="nav-accounts" onclick="switchTab('accounts')">ğŸ‘¥ å¸³è™Ÿå¯†ç¢¼è¨­å®š</div>
            <div style="margin-top:50px">
                <button class="btn btn-outline" style="width:100%; justify-content:center" onclick="location.reload()">ğŸ”’ å®‰å…¨ç™»å‡º</button>
            </div>
        </div>

        <div class="main-content">
            <div id="tab-orders">
                <h1>è¨‚å–®ç®¡ç†ç³»çµ±</h1>
                <div class="panel">
                    <div style="display:flex; gap:10px; margin-bottom:20px; align-items:flex-end">
                        <input type="date" id="filterStart"> <span style="padding-bottom:10px">è‡³</span> <input type="date" id="filterEnd">
                        <button class="btn btn-primary" onclick="filterOrders()">ç¯©é¸å€é–“</button>
                        <button class="btn btn-success" onclick="downloadCSV()">ä¸‹è¼‰å ±è¡¨ (CSV)</button>
                    </div>
                    <table>
                        <thead>
                            <tr><th>æ—¥æœŸ</th><th>è¨‚å–®è™Ÿ</th><th>ç”³è«‹äºº</th><th>è¨‚è³¼å…§å®¹</th><th>ç•¶å‰ç‹€æ…‹</th><th>æ“ä½œè½‰æ›</th></tr>
                        </thead>
                        <tbody id="orderTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="tab-inventory" class="hidden">
                <h1>å•†å“åº«å­˜ç›¤é»</h1>
                <div class="panel">
                    <p style="color:#666; margin-bottom:20px">é€™è£¡å¯ä»¥å°ç¾æœ‰å•†å“çš„åº«å­˜é€²è¡ŒåŠ æ¸›ç›¤é»ã€‚</p>
                    <table>
                        <thead><tr><th>åœ–ç‰‡</th><th>å•†å“åç¨±</th><th>å–®åƒ¹</th><th>ç›®å‰åº«å­˜</th><th>ç›¤é»èª¿æ•´</th><th>æ“ä½œ</th></tr></thead>
                        <tbody id="inventoryBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="tab-listing" class="hidden">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                    <h1>å•†å“ä¸Šæ¶ç®¡ç†</h1>
                    <button class="btn btn-primary" onclick="openAddModal()">ï¼‹ æ–°å¢å•†å“ä¸Šç·š</button>
                </div>
                <div class="panel">
                    <table>
                        <thead><tr><th>åœ–ç‰‡</th><th>å•†å“åç¨±</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th></tr></thead>
                        <tbody id="listingBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="tab-accounts" class="hidden">
                <h1>ç³»çµ±å¸³è™Ÿç®¡ç†</h1>
                <div class="panel">
                    <div style="display:flex; gap:10px; margin-bottom:30px">
                        <input type="text" id="newAccUser" placeholder="æ–°å¸³è™Ÿ">
                        <input type="password" id="newAccPass" placeholder="æ–°å¯†ç¢¼">
                        <button class="btn btn-primary" onclick="addAccount()">æ–°å¢ç®¡ç†å“¡</button>
                    </div>
                    <table>
                        <thead><tr><th>å¸³è™Ÿåç¨±</th><th>è§’è‰²</th><th>ç®¡ç†</th></tr></thead>
                        <tbody id="accountTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="mainModal" class="modal">
        <div class="modal-body" id="modalBody">
            </div>
    </div>

    <script>
        // åˆå§‹åŒ–è™›æ“¬è³‡æ–™ (5-6å€‹è™›æ“¬å•†å“)
        let ITEMS = [
            {id: 1, name: 'æ«»èŠ±ç²‰å¹³å®‰åŒ…', price: 460, stock: 25, img: 'https://via.placeholder.com/60/FFC1CC/white?text=Bag', active: true},
            {id: 2, name: 'ç¿è­·ç²¾è£½é‹¼ç­†', price: 800, stock: 12, img: 'https://via.placeholder.com/60/FF66A1/white?text=Pen', active: true},
            {id: 3, name: 'ä¿æº«éš¨è¡Œæ¯', price: 550, stock: 8, img: 'https://via.placeholder.com/60/FFB3D1/white?text=Cup', active: true},
            {id: 4, name: 'ç™‚ç™’ç²‰ç´…æ¤æ ½', price: 320, stock: 15, img: 'https://via.placeholder.com/60/FF99C8/white?text=Plant', active: true},
            {id: 5, name: 'é˜²æ°´é‡é¤å¢Š', price: 450, stock: 20, img: 'https://via.placeholder.com/60/FFD1E1/white?text=Mat', active: true},
            {id: 6, name: 'å¸†å¸ƒæç±ƒ', price: 280, stock: 30, img: 'https://via.placeholder.com/60/FF94B2/white?text=Box', active: true}
        ];

        let ORDERS = [
            {id:'TASK-001', date:'2026-02-10', user:'é™³å¤§åŒ (104114)', items:[{n:'æ«»èŠ±ç²‰å¹³å®‰åŒ…', q:1}], status:'ç”³è«‹æå‡º', memo:''},
            {id:'TASK-002', date:'2026-02-12', user:'æé›…å©· (104225)', items:[{n:'ç¿è­·ç²¾è£½é‹¼ç­†', q:2}, {n:'ä¿æº«éš¨è¡Œæ¯', q:1}], status:'å•†å“æº–å‚™ä¸­', memo:''},
            {id:'TASK-003', date:'2026-02-13', user:'å¼µå°ˆå“¡ (104331)', items:[{n:'ç™‚ç™’ç²‰ç´…æ¤æ ½', q:5}], status:'ç•°å¸¸é€šçŸ¥', memo:'æ¤ç‰©é…é€éœ€å†·è—ï¼Œç›®å‰ç‰©æµèª¿æ•´ä¸­'}
        ];

        let ACCOUNTS = [{user:'admin', pass:'1234', role:'è¶…ç´šç®¡ç†å“¡'}];

        function handleLogin() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            if(ACCOUNTS.find(a => a.user === u && a.pass === p)) {
                document.getElementById('loginView').style.display = 'none';
                document.getElementById('adminView').style.display = 'block';
                renderAll();
            } else alert('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤');
        }

        function switchTab(t) {
            ['orders','inventory','listing','accounts'].forEach(id => {
                document.getElementById('tab-'+id).classList.add('hidden');
                document.getElementById('nav-'+id).classList.remove('active');
            });
            document.getElementById('tab-'+t).classList.remove('hidden');
            document.getElementById('nav-'+t).classList.add('active');
        }

        function renderAll() {
            renderOrders();
            renderInventory();
            renderListing();
            renderAccounts();
        }

        // --- è¨‚å–®é‚è¼¯ ---
        function renderOrders(data = ORDERS) {
            document.getElementById('orderTable').innerHTML = data.map(o => `
                <tr>
                    <td>${o.date}</td><td><b>${o.id}</b></td><td>${o.user}</td>
                    <td><button class="btn btn-outline" onclick="showOrderDetail('${o.id}')">æŸ¥çœ‹æ˜ç´°</button></td>
                    <td><span class="status-pill status-${getStatusID(o.status)}">${o.status}</span></td>
                    <td>
                        <select onchange="changeOrderStatus('${o.id}', this.value)">
                            <option value="">è®Šæ›´ç‚º...</option>
                            <option value="ç”³è«‹æå‡º">ç”³è«‹æå‡º</option>
                            <option value="å•†å“æº–å‚™ä¸­">å•†å“æº–å‚™ä¸­</option>
                            <option value="é€šçŸ¥é ˜å–">é€šçŸ¥é ˜å– (è‡ªå‹•ç™¼ä¿¡)</option>
                            <option value="ç•°å¸¸é€šçŸ¥">ç•°å¸¸é€šçŸ¥</option>
                        </select>
                    </td>
                </tr>
            `).join('');
        }

        function showOrderDetail(id) {
            const o = ORDERS.find(ord => ord.id === id);
            openModal(`
                <h3>è¨‚å–®å…§å®¹æ˜ç´°</h3>
                <div style="background:#FFF5F8; padding:15px; border-radius:12px">
                    ${o.items.map(i => `<p>ğŸŒ¸ ${i.n} x ${i.q}</p>`).join('')}
                </div>
                ${o.memo ? `<p style="color:var(--danger); font-size:13px; margin-top:10px">âš ï¸ ç•°å¸¸å‚™è¨»ï¼š${o.memo}</p>` : ''}
                <button class="btn btn-primary" style="width:100%; margin-top:20px" onclick="closeModal()">é—œé–‰è¦–çª—</button>
            `);
        }

        function changeOrderStatus(id, status) {
            if(!status) return;
            if(status === 'é€šçŸ¥é ˜å–') {
                if(confirm('ç¢ºå®šè¦åŸ·è¡Œ Workflow ç™¼é€åˆ¶å¼åŒ–é ˜å–ä¿¡ä»¶å—ï¼Ÿ')) {
                    alert('å·²æˆåŠŸä¸²è¯ n8n ç™¼é€é€šçŸ¥çµ¦ï¼š' + id);
                    updateOrder(id, status);
                }
            } else if(status === 'ç•°å¸¸é€šçŸ¥') {
                const memo = prompt('è«‹è¼¸å…¥ç•°å¸¸åŸå›  (30-50å­—)ï¼š');
                if(!memo) return;
                updateOrder(id, status, memo);
            } else {
                updateOrder(id, status);
            }
        }

        function updateOrder(id, s, m = '') {
            const o = ORDERS.find(ord => ord.id === id);
            o.status = s;
            if(m) o.memo = m;
            renderOrders();
        }

        // --- åº«å­˜ç›¤é» ---
        function renderInventory() {
            document.getElementById('inventoryBody').innerHTML = ITEMS.filter(i => i.active).map(i => `
                <tr>
                    <td><img src="${i.img}" class="img-preview"></td>
                    <td>${i.name}</td>
                    <td>$${i.price}</td>
                    <td><b>${i.stock}</b></td>
                    <td><input type="number" id="adj-${i.id}" value="0" style="width:60px"></td>
                    <td><button class="btn btn-success" onclick="adjustStock(${i.id})">æ›´æ–°ç›¤é»</button></td>
                </tr>
            `).join('');
        }

        function adjustStock(id) {
            const val = parseInt(document.getElementById('adj-'+id).value);
            const item = ITEMS.find(i => i.id === id);
            item.stock += val;
            renderInventory();
            alert('åº«å­˜å·²èª¿æ•´ï¼');
        }

        // --- å•†å“ç®¡ç†èˆ‡ä¸‹æ¶ ---
        function renderListing() {
            document.getElementById('listingBody').innerHTML = ITEMS.map(i => `
                <tr>
                    <td><img src="${i.img}" class="img-preview"></td>
                    <td>${i.name}</td>
                    <td>${i.active ? '<span style="color:green">â— è²©å”®ä¸­</span>' : '<span style="color:red">â— å·²ä¸‹æ¶</span>'}</td>
                    <td>
                        ${i.active ? `<button class="btn btn-danger" onclick="toggleItem(${i.id})">ç«‹å³ä¸‹æ¶</button>` : `<button class="btn btn-primary" onclick="toggleItem(${i.id})">é‡æ–°ä¸Šæ¶</button>`}
                    </td>
                </tr>
            `).join('');
        }

        function toggleItem(id) {
            const item = ITEMS.find(i => i.id === id);
            item.active = !item.active;
            renderListing();
            renderInventory();
        }

        function openAddModal() {
            openModal(`
                <h3>æ–°å¢å…¬é—œå•†å“ä¸Šç·š</h3>
                <label>å•†å“åœ–ç‰‡ä¸Šå‚³</label>
                <input type="file" id="newImg" style="margin-bottom:15px">
                <label>å•†å“åç¨±</label>
                <input type="text" id="newName" placeholder="ä¾‹ï¼šç²‰è‰²å¸†å¸ƒè¢‹" style="width:100%">
                <label>å•†å“å–®åƒ¹</label>
                <input type="number" id="newPrice" value="100" style="width:100%">
                <div style="display:flex; gap:10px; margin-top:20px">
                    <button class="btn btn-outline" style="flex:1" onclick="closeModal()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" style="flex:1" onclick="addNewItem()">ç¢ºèªä¸Šæ¶</button>
                </div>
            `);
        }

        function addNewItem() {
            const n = document.getElementById('newName').value;
            const p = parseInt(document.getElementById('newPrice').value);
            if(!n) return alert('è«‹å¡«å¯«åç¨±');
            ITEMS.push({id: Date.now(), name: n, price: p, stock: 0, img: 'https://via.placeholder.com/60/FF66A1/white?text=New', active: true});
            renderAll();
            closeModal();
            alert('å•†å“å·²æˆåŠŸä¸Šç·šï¼');
        }

        // --- å¸³è™Ÿç®¡ç† ---
        function addAccount() {
            const u = document.getElementById('newAccUser').value;
            const p = document.getElementById('newAccPass').value;
            if(!u || !p) return;
            ACCOUNTS.push({user: u, pass: p, role: 'ç®¡ç†å“¡'});
            renderAccounts();
            alert('ç®¡ç†å“¡å¸³è™Ÿå·²æ–°å¢');
        }

        function renderAccounts() {
            document.getElementById('accountTable').innerHTML = ACCOUNTS.map(a => `
                <tr><td>${a.user}</td><td>${a.role}</td><td><button class="btn btn-danger" onclick="alert('Demoç’°å¢ƒä¸æ”¯æ´åˆªé™¤')">åœç”¨</button></td></tr>
            `).join('');
        }

        // --- å·¥å…·é¡ ---
        function getStatusID(s) { return {'ç”³è«‹æå‡º':1, 'å•†å“æº–å‚™ä¸­':2, 'é€šçŸ¥é ˜å–':3, 'ç•°å¸¸é€šçŸ¥':4}[s]; }
        function openModal(html) { document.getElementById('modalBody').innerHTML = html; document.getElementById('mainModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('mainModal').style.display = 'none'; }
        function filterOrders() { alert('å€é–“ç¯©é¸åŠŸèƒ½å·²åŸ·è¡Œ (Demoç’°å¢ƒ)'); }
        function downloadCSV() {
            let csv = "\ufeffæ—¥æœŸ,è¨‚å–®è™Ÿ,ç”³è«‹äºº,ç‹€æ…‹\n";
            ORDERS.forEach(o => csv += `${o.date},${o.id},${o.user},${o.status}\n`);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "å…¬é—œå“è¨‚å–®å ±è¡¨.csv";
            link.click();
        }
    </script>
</body>
</html>
