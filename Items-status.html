<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>å…¬é—œå“ç”³è«‹ç‹€æ…‹çœ‹æ¿</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", Arial, sans-serif;
  background:#f6f7f9;
  padding:20px;
}

h1 {
  text-align:center;
  margin-bottom:20px;
}

/* ===== æŸ¥è©¢å€ ===== */
.search-box {
  max-width:1200px;
  margin:0 auto 24px;
  display:flex;
  gap:10px;
}

.search-box input {
  flex:1;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}

.search-box button {
  padding:10px 16px;
  border:none;
  border-radius:8px;
  background:#0A84FF;
  color:#fff;
  cursor:pointer;
}

/* ===== é€²è¡Œä¸­å¡ç‰‡ ===== */
.board {
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap:20px;
  max-width:1200px;
  margin:auto;
}

.card {
  background:#fff;
  border-radius:12px;
  padding:16px;
  box-shadow:0 2px 10px rgba(0,0,0,0.08);
}

.card .title {
  font-size:18px;
  font-weight:700;
  margin-bottom:6px;
}

.card .sub {
  font-size:14px;
  margin-bottom:4px;
}

.card .money {
  font-size:15px;
  font-weight:600;
  margin-top:6px;
}

/* ===== ç‹€æ…‹åˆ— ===== */
.timeline {
  display:flex;
  align-items:center;
  margin:14px 0;
}

.step {
  flex:1;
  text-align:center;
  font-size:12px;
  position:relative;
  color:#999;
}

.step::before {
  content:'';
  display:block;
  width:14px;
  height:14px;
  margin:0 auto 6px;
  border-radius:50%;
  background:#ccc;
}

.step::after {
  content:'';
  position:absolute;
  top:7px;
  left:50%;
  width:100%;
  height:2px;
  background:#ccc;
  z-index:-1;
}

.step:last-child::after { display:none; }

.step.done { color:#0A84FF; }
.step.done::before,
.step.done::after { background:#0A84FF; }

.step.current { color:#28a745; font-weight:bold; }
.step.current::before { background:#28a745; }

.step.exception { color:#dc3545; font-weight:bold; }
.step.exception::before { background:#dc3545; }

/* ===== æ˜ç´° ===== */
.details {
  display:none;
  margin-top:10px;
  font-size:13px;
  color:#555;
  border-top:1px dashed #ddd;
  padding-top:10px;
}

.toggle-btn {
  margin-top:8px;
  background:none;
  border:none;
  color:#0A84FF;
  cursor:pointer;
  font-size:14px;
}

/* ===== çµæ¡ˆæ¸…å–® ===== */
.archive {
  max-width:1200px;
  margin:40px auto 0;
}

.archive h3 {
  cursor:pointer;
  font-size:16px;
}

.archive table {
  width:100%;
  border-collapse:collapse;
  background:#fff;
  margin-top:10px;
  display:none;
}

.archive th, .archive td {
  border-bottom:1px solid #eee;
  padding:8px;
  font-size:14px;
  text-align:left;
  vertical-align:top;
}

.archive th {
  background:#f0f2f5;
  cursor:pointer;
  user-select:none;
}

.sort-icon {
  margin-left:6px;
  font-size:11px;
  color:#888;
}
.sort-active {
  color:#0A84FF;
  font-weight:bold;
}
</style>
</head>

<body>

<h1>ğŸ“¦ å…¬é—œå“ç”³è«‹ç‹€æ…‹çœ‹æ¿</h1>

<!-- æŸ¥è©¢ -->
<div class="search-box">
  <input id="staffInput" placeholder="è¼¸å…¥å“¡ç·¨ï¼ˆ6ç¢¼ï¼‰æŸ¥è©¢æ‰€æœ‰ç´€éŒ„" />
  <button onclick="render()">æŸ¥è©¢</button>
</div>

<!-- é€²è¡Œä¸­è¨‚å–® -->
<div class="board" id="activeBoard"></div>

<!-- çµæ¡ˆæ¸…å–® -->
<div class="archive">
  <h3 onclick="toggleArchive()">â–¸ çµæ¡ˆæ¸…å–®ï¼ˆé»æ“Šå±•é–‹ï½œè¿‘åŠå¹´ï¼‰</h3>
  <table id="archiveTable">
    <thead>
      <tr>
        <th onclick="sortArchive('task_id')">è¨‚å–®ç·¨è™Ÿ<span id="icon-task_id" class="sort-icon"></span></th>
        <th onclick="sortArchive('name')">ç”³è«‹äºº<span id="icon-name" class="sort-icon"></span></th>
        <th onclick="sortArchive('dept')">éƒ¨é–€<span id="icon-dept" class="sort-icon"></span></th>
        <th>è³¼è²·å…§å®¹</th>
        <th onclick="sortArchive('amount')">ç¸½é‡‘é¡<span id="icon-amount" class="sort-icon"></span></th>
        <th onclick="sortArchive('close')">çµæ¡ˆæ—¥æœŸ<span id="icon-close" class="sort-icon sort-active">â–¼</span></th>
      </tr>
    </thead>
    <tbody id="archiveBody"></tbody>
  </table>
</div>

<script>
/* ===== æ’åºç‹€æ…‹ ===== */
let archiveSort = { key:'close', asc:false };

/* ===== è™›æ“¬è³‡æ–™ï¼ˆ6 ç¢¼å“¡ç·¨ï¼‰ ===== */
const orders = [
  { task_id:'TASK-20260204-031', name:'ç‹å°æ˜', staff:'123456', dept:'æ€¥è¨ºé†«å­¸éƒ¨', date:'2026/02/04', close:'', amount:1240, status:'PREPARING', items:['ç’°ä¿æè¢‹ Ã— 20','ä¸‰è‰²ç­† Ã— 30'] },
  { task_id:'TASK-20260203-028', name:'é™³é›…å©·', staff:'234567', dept:'è­·ç†éƒ¨', date:'2026/02/03', close:'', amount:980, status:'SUBMITTED', items:['å®£å°è³‡æ–™å¤¾ Ã— 50'] },
  { task_id:'TASK-20260202-021', name:'æ—å¿—å®', staff:'345678', dept:'æ•™å­¸éƒ¨', date:'2026/02/02', close:'', amount:560, status:'EXCEPTION', items:['è­˜åˆ¥è­‰å¥— Ã— 40'] },
  { task_id:'TASK-20260131-018', name:'é»ƒæ€¡å›', staff:'456789', dept:'äººè³‡å®¤', date:'2026/01/31', close:'2026/02/05', amount:460, status:'READY', items:['åŒ—é†«å¹³å®‰åŒ… Ã— 1'] },
  { task_id:'TASK-20260128-011', name:'å¼µå¿—ç¶­', staff:'567890', dept:'é†«å­¸æ•™è‚²ä¸­å¿ƒ', date:'2026/01/28', close:'2026/02/01', amount:3200, status:'READY', items:['ç ”è¨æœƒèƒŒè¢‹ Ã— 100'] },
  { task_id:'TASK-20260120-006', name:'æä½©çŠ', staff:'678901', dept:'ç¤¾æœå®¤', date:'2026/01/20', close:'2026/01/29', amount:1500, status:'READY', items:['å®£å°æ¯›å·¾ Ã— 50','ç’°ä¿æ¯ Ã— 10'] }
];

function sortArchive(key){
  if(archiveSort.key === key){
    archiveSort.asc = !archiveSort.asc;
  }else{
    archiveSort.key = key;
    archiveSort.asc = true;
  }
  render();
}

function updateSortIcons(){
  document.querySelectorAll('.sort-icon').forEach(i=>{
    i.textContent = '';
    i.classList.remove('sort-active');
  });
  const icon = document.getElementById('icon-'+archiveSort.key);
  icon.textContent = archiveSort.asc ? 'â–²' : 'â–¼';
  icon.classList.add('sort-active');
}

function render(){
  const staff = document.getElementById('staffInput').value.trim();
  const active = document.getElementById('activeBoard');
  const archive = document.getElementById('archiveBody');
  active.innerHTML='';
  archive.innerHTML='';

  const filtered = orders.filter(o=>!staff || o.staff===staff);

  // ===== é€²è¡Œä¸­ =====
  filtered.filter(o=>o.status!=='READY').forEach(o=>{
    active.innerHTML += `
    <div class="card">
      <div class="title">${o.name}ï¼ˆ${o.staff}ï¼‰ï½œ${o.dept}</div>
      <div class="sub">è¨‚å–®ç·¨è™Ÿï¼š${o.task_id}</div>
      <div class="sub">ç”³è«‹æ—¥æœŸï¼š${o.date}</div>
      <div class="money">ç¸½é‡‘é¡ï¼šNT$ ${o.amount}</div>

      <div class="timeline">
        <div class="step done">ç”³è«‹æå‡º</div>
        <div class="step ${o.status==='PREPARING'?'current':''}">å•†å“æº–å‚™ä¸­</div>
        <div class="step">å·²é€šçŸ¥é ˜å–</div>
        <div class="step ${o.status==='EXCEPTION'?'exception current':''}">ç•°å¸¸é€šçŸ¥</div>
      </div>

      <button class="toggle-btn" onclick="toggleDetails(this)">æŸ¥çœ‹æ¡ˆä»¶æ˜ç´°</button>
      <div class="details">${o.items.join('<br>')}</div>
    </div>`;
  });

  // ===== çµæ¡ˆ =====
  const archived = filtered.filter(o=>o.status==='READY');
  archived.sort((a,b)=>{
    let va=a[archiveSort.key], vb=b[archiveSort.key];
    if(archiveSort.key==='amount'){ va=+va; vb=+vb; }
    if(archiveSort.key==='close'){ va=new Date(va); vb=new Date(vb); }
    if(va>vb) return archiveSort.asc?1:-1;
    if(va<vb) return archiveSort.asc?-1:1;
    return 0;
  });

  archived.forEach(o=>{
    archive.innerHTML += `
    <tr>
      <td>${o.task_id}</td>
      <td>${o.name}ï¼ˆ${o.staff}ï¼‰</td>
      <td>${o.dept}</td>
      <td>${o.items.join('<br>')}</td>
      <td>NT$ ${o.amount}</td>
      <td>${o.close}</td>
    </tr>`;
  });

  updateSortIcons();
}

function toggleDetails(btn){
  const d=btn.nextElementSibling;
  const open=d.style.display==='block';
  d.style.display=open?'none':'block';
  btn.textContent=open?'æŸ¥çœ‹æ¡ˆä»¶æ˜ç´°':'æ”¶åˆæ¡ˆä»¶æ˜ç´°';
}

function toggleArchive(){
  const t=document.getElementById('archiveTable');
  t.style.display=t.style.display==='table'?'none':'table';
}

render();
</script>

</body>
</html>
